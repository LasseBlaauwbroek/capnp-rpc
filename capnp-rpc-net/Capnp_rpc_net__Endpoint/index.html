<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Capnp_rpc_net__Endpoint (capnp-rpc-net.Capnp_rpc_net__Endpoint)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">capnp-rpc-net</a> &#x00BB; Capnp_rpc_net__Endpoint</nav><h1>Module <code>Capnp_rpc_net__Endpoint</code></h1><p>Send and receive capnp messages over a byte-stream.</p></header><dl><dt class="spec value" id="val-src"><a href="#val-src" class="anchor"></a><code><span class="keyword">val</span> src : Logs.src</code></dt><dd><p>Control the log level.</p></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>A wrapper for a byte-stream (flow).</p></dd></dl><dl><dt class="spec value" id="val-send"><a href="#val-send" class="anchor"></a><code><span class="keyword">val</span> send : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Capnp.BytesMessage.Message.t</span> <span>&#45;&gt;</span> <span><span><span>(unit, <span>[ `Closed <span><span>| `Msg</span> of string</span> ]</span>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p><code>send t msg</code> transmits <code>msg</code>.</p></dd></dl><dl><dt class="spec value" id="val-recv"><a href="#val-recv" class="anchor"></a><code><span class="keyword">val</span> recv : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span><span>(<span>Capnp.Message.ro Capnp.BytesMessage.Message.t</span>, <span>[&gt; `Closed ]</span>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p><code>recv t</code> reads the next message from the remote peer. It returns <code>Error `Closed</code> if the connection to the peer is lost (this will also happen if the switch is turned off).</p></dd></dl><dl><dt class="spec value" id="val-of_flow"><a href="#val-of_flow" class="anchor"></a><code><span class="keyword">val</span> of_flow : <span>switch:Lwt_switch.t</span> <span>&#45;&gt;</span> <span>peer_id:<a href="../Capnp_rpc_net/Auth/Digest/index.html#type-t">Capnp_rpc_net.Auth.Digest.t</a></span> <span>&#45;&gt;</span> <span>(<span class="keyword">module</span> Mirage_flow.S <span class="keyword">with</span> <span class="keyword">type</span> flow = <span class="type-var">'flow</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'flow</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>of_flow ~switch ~peer_id (module F) flow</code> sends and receives on <code>flow</code>. The caller should arrange for <code>flow</code> to be closed when the switch is turned off. If the flow is closed, the switch will be turned off. If the flow returns an error when the switch is off, the endpoint will return <code>`Closed</code> instead of the underlying error.</p></dd></dl><dl><dt class="spec value" id="val-peer_id"><a href="#val-peer_id" class="anchor"></a><code><span class="keyword">val</span> peer_id : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Capnp_rpc_net/Auth/Digest/index.html#type-t">Capnp_rpc_net.Auth.Digest.t</a></code></dt><dd><p><code>peer_id t</code> is the fingerprint of the peer's public key, or <code>Auth.Digest.insecure</code> TLS isn't being used.</p></dd></dl><dl><dt class="spec value" id="val-disconnect"><a href="#val-disconnect" class="anchor"></a><code><span class="keyword">val</span> disconnect : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>disconnect t</code> turns off <code>t</code>'s switch.</p></dd></dl><dl><dt class="spec value" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><code><span class="keyword">val</span> pp_error : <span><span>[&lt; `Closed <span><span>| `Msg</span> of string</span> ]</span> Fmt.t</span></code></dt></dl></div></body></html>